<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8" />
  <title></title>
  <link type="text/css" href="style.css" rel="stylesheet">
</head>

<body onLoad="onLoad();">
  <table>
    <tr>
      <th>Step</th>
      <th>Description</th>
      <th>Detail</th>
    </tr>
    <tr>
      <td>1</td>
      <td>Create a private key and derive a camo public key</td>
      <td>
        <form action="." method="get" onsubmit="return submitForm();">
          Private Key:<br>
          <input id="private_key" name="private_key" value="" size="64" type="text">
          <p>
            <input value="New Random Private Key" type="button" onclick='return getNewPrivateKey();'>
          </p>
          <p>
            Camo Public Key:<br>
            <input id="camo_public_key" name="camo_public_key" value="" size="64" type="text">
          </p>
          <p><input value="Derive Camo Public Key" type="submit">
          </p>
        </form>
      </td>
    </tr>
  </table>
  <script src='camo.js'></script>
  <script src='https://coranos.github.io/js-lib/nacl.js'></script>
  <script>
    const hexToBytes = (hex) => {
      const ret = new Uint8Array(hex.length / 2);
      for (var i = 0; i < ret.length; i++) {
        ret[i] = parseInt(hex.substring(i * 2, i * 2 + 2), 16);
      }
      return ret;
    }

    const bytesToHex = (array) => {
      return [...array].map(b => b.toString(16))
        .join('');
    }
    const getCamoPublicKeyBytes = (privateKeyBytes) => {
      const camoPrivateKeyBytes = nacl.camo.hashsecret(privateKeyBytes);
      const camoPublicKeyBytes = nacl.camo.scalarMult.base(camoPrivateKeyBytes);
      return camoPublicKeyBytes;
    }

    const getNewPrivateKey = () => {
      const private_key_elt = document.getElementById('private_key');
      const privateKey = new Uint8Array(32);
      window.crypto.getRandomValues(privateKey);
      const hex = bytesToHex(privateKey);
      private_key_elt.value = hex;
      return false;
    }

    const submitForm = () => {
      const private_key_elt = document.getElementById('private_key');
      const privateKeyBytes = hexToBytes(private_key_elt.value);
      const camoPublicKeyBytes = getCamoPublicKeyBytes(privateKeyBytes);
      const camoPublicKey = bytesToHex(camoPublicKeyBytes);
      const camo_public_key_elt = document.getElementById('camo_public_key');
      camo_public_key_elt.value = 'camo_public_key';
      return false;
    }
    const onLoad = () => {

    }
  </script>
</body>

</html>
